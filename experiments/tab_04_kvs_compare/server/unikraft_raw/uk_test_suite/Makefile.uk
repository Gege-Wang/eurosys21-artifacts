$(eval $(call addlib,apptestsuite))
ifeq ($(CONFIG_APPTESTSUITE_KERNARGS),y)
$(eval $(call addlib_paramprefix,apptestsuite,test))
endif

APPTESTSUITE_CINCLUDES-y    += -I$(APPTESTSUITE_BASE)/include


APPTESTSUITE_SRCS-y += $(APPTESTSUITE_BASE)/main.c
EXTRA_LD_SCRIPT-y += $(APPTESTSUITE_BASE)/testsuite.ld

## FDT Test suite.
APPTESTSUITE_CINCLUDES-$(CONFIG_APPTESTSUITE_FDT)     += -I$(UK_PLAT_DRIVERS_BASE)/include
APPTESTSUITE_CINCLUDES-$(CONFIG_APPTESTSUITE_FDT)     += -I$(LIBKVMPLAT_BASE)/include
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_FDT) += $(APPTESTSUITE_BASE)/test_fdt/test_fdt.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_FDT) += $(APPTESTSUITE_BASE)/test_fdt/test.dts


## GIC Test suite.
APPTESTSUITE_CINCLUDES-$(CONFIG_APPTESTSUITE_GICV2)     += -I$(UK_PLAT_DRIVERS_BASE)/include
APPTESTSUITE_CINCLUDES-$(CONFIG_APPTESTSUITE_GICV2)     += -I$(LIBKVMPLAT_BASE)/include
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_GICV2) += $(APPTESTSUITE_BASE)/gicv2/test_gicv2.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_GICV2) += $(APPTESTSUITE_BASE)/gicv2/test.dts

## Adding the test for kernel arguments
## TODO: Define a Variable to separate the Unit Test case from the Functional
## tests.
## TODO: Separate Multiple makefile. Makes it easier to manage.

#APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_KERNARGS) +=\
#			 $(APPTESTPARAM_BASE)/test_libukparam/test_ucparam.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_KERNARGS) +=\
			 $(APPTESTSUITE_BASE)/test_libukparam/test_ukparam.c
APPTESTSUITE_CFLAGS-$(CONFIG_APPTESTSUITE_KERNARGS) += \
			-save-temps=obj -DUK_DEBUG

APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_UC_LIBPARAM) +=\
			 $(APPTESTSUITE_BASE)/test_libukparam/test_ucparam.c
APPTESTSUITE_CFLAGS-$(CONFIG_APPTESTSUITE_UC_LIBPARAM) += \
					-I$(CONFIG_UK_BASE)/lib/uklibparam/
APPTESTSUITE_CFLAGS-$(CONFIG_APPTESTSUITE_UC_LIBPARAM) += \
		-DUK_LIBPARAM_PREFIX=apptestsuite -save-temps=obj\
		-I$(CONFIG_UK_BASE)/lib/uklibparam/include -DUK_DEBUG
EXTRA_LD_SCRIPT-$(CONFIG_APPTESTSUITE_UC_LIBPARAM) += \
			$(APPTESTSUITE_BASE)/test_libukparam/libparam.lds


APPTESTSUITE_SRCS-$(CONFIG_VFSCORETEST_OPEN) += \
			$(APPTESTSUITE_BASE)/test_vfscore/test_open.c
APPTESTSUITE_SRCS-$(CONFIG_VFSCORETEST_STAT) += \
			$(APPTESTSUITE_BASE)/test_vfscore/test_stat.c
APPTESTSUITE_SRCS-$(CONFIG_VFSCORETEST_IOCTL) += \
			$(APPTESTSUITE_BASE)/test_vfscore/test_ioctl.c
APPTESTSUITE_SRCS-$(CONFIG_VFSCORETEST_MOUNT) += \
			$(APPTESTSUITE_BASE)/test_vfscore/test_mount.c


APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_LOCK) += \
			$(APPTESTSUITE_BASE)/test_lock/test_lock.c

APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_LDS) += \
			$(APPTESTSUITE_BASE)/test_lds/test.ld

APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_LDS) += \
			$(APPTESTSUITE_BASE)/test_lds/lds_test.c
APPTESTSUITE_CFLAGS-$(CONFIG_APPTESTSUITE_LDS) += -save-temps=obj

## TEST SUITE FOR NETDEVICE
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_INITTAB) += \
			$(APPTESTSUITE_BASE)/test_inittab/test_inittab.c
APPTESTSUITE_CFLAGS-$(CONFIG_APPTESTSUITE_INITTAB) += -save-temps=obj

## TEST SUITE FOR NETDEVICE
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_NETDEV) += $(APPTESTSUITE_BASE)/test_netdev/test_netdev.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_UK_LWIP) += $(APPTESTSUITE_BASE)/test_lwip/test_lwip.c

## TEST SUITE FOR DPDK
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_RING) += $(APPTESTSUITE_BASE)/test_dpdk/test_ring/test_ring.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_INIT) += $(APPTESTSUITE_BASE)/test_dpdk/test_init/init.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_MEMORY) += $(APPTESTSUITE_BASE)/test_dpdk/test_memory/test_memory.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_BASIC_FWD) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/pktgen.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_BASIC_FWD) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/dev.c

APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_TXONLY) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/txonly.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_RTT) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/rtt.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_CLOSED_LOOP) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/closed_loop_latency.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_RXONLY) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/rxonly.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_CL_SERVER) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/cl_tx_rx.c
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_DPDK_UDP_ECHO) += $(APPTESTSUITE_BASE)/test_dpdk/basic_forward/udp_echo.c


## Test suite for raw netdev performance.
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_RAW_NETDEV) += $(APPTESTSUITE_BASE)/perf_netdev/main_nolwip.c

## TEST SUITE FOR STRING
APPTESTSUITE_SRCS-$(CONFIG_APPTESTSUITE_STRTOK_R) += \
				$(APPTESTSUITE_BASE)/test_string/strtok_r.c
